# 图形学基础：2.11 动画与蒙皮

本文覆盖 `面经题目分类汇总.md` 中图形学基础的 `2.11 动画与蒙皮` 全部题目。
每个题目包含：标准准确的说法、通俗易懂的理解、面试回答简版模板、难点深挖。

---

## 题目：蒙皮动画的原理？

### 标准准确的说法
- 蒙皮动画（Skinning）核心是“骨骼驱动网格顶点变换”。
- 顶点通常绑定 1~4 个骨骼，每个骨骼有权重 `w_i`，满足权重和约等于 1。
- 线性混合蒙皮（LBS）常见公式：
- `v' = Σ w_i * (M_i * v_bind)`
- 其中 `M_i` 是骨骼当前姿态与绑定姿态相关变换（常含 inverse bind）。
- 常见问题是关节处体积塌陷（candy-wrapper），可用 DQS（双四元数蒙皮）改进。

### 通俗易懂的理解
- 网格像皮肤，骨骼像骨架。每个顶点“听几个骨骼的话”，按权重混合后得到最终位置。

### 面试回答简版模板
`蒙皮动画是骨骼矩阵按顶点权重加权驱动网格。主流是LBS，简单高效；对关节扭转伪影可用DQS等方法改善。`

### 难点深挖
```mermaid
flowchart LR
  A[动画曲线采样] --> B[求各骨骼当前姿态]
  B --> C[骨骼矩阵 * inverse bind]
  C --> D[顶点按权重混合变换]
  D --> E[输出蒙皮后顶点]
```
- 高频追问：inverse bind 为什么必须有？
- 因为顶点初始在绑定姿态空间，需要先回到骨骼局部基准再应用当前姿态。

---

## 题目：GPU蒙皮动画的实现？

### 标准准确的说法
- GPU 蒙皮通常在 Vertex Shader 或 Compute Shader 完成。
- 基本输入：
- 顶点属性：position/normal/tangent + bone indices + bone weights。
- uniform/SSBO：骨骼矩阵数组。
- VS 蒙皮优点：流程直观，与常规渲染阶段紧耦合。
- Compute 蒙皮优点：可复用结果（多个 pass），支持更复杂后处理与缓存策略。
- 性能关键：骨骼矩阵上传、数据布局、缓存友好性、实例化角色批处理。

### 通俗易懂的理解
- CPU 算蒙皮会很吃性能，通常把“每顶点算骨骼混合”交给 GPU 并行完成。

### 面试回答简版模板
`GPU蒙皮通常在VS或Compute做。VS实现简单，Compute更利于多pass复用。优化重点在骨骼数据传输、顶点布局和批处理。`

### 难点深挖
- 追问：为什么大规模角色场景还会卡？
- 常见瓶颈在顶点吞吐和骨骼数据带宽，不只是“是否用了GPU蒙皮”。

---

## 题目：IK(逆向动力学)和FK(正向动力学)的了解？

### 标准准确的说法
- FK（Forward Kinematics）：从父到子逐级应用关节旋转，得到末端姿态。
- IK（Inverse Kinematics）：已知末端目标位姿，反解关节参数。
- FK 控制直观、稳定；IK 更适合脚踩地、手抓物、瞄准等约束型动作。
- 常见 IK 解法：解析解（特定链）、CCD、FABRIK、Jacobian 方法。
- 工程中常是 FK 动画为主、IK 做后修正（例如脚底贴地）。

### 通俗易懂的理解
- FK 是“转关节得到手脚位置”；IK 是“指定手脚要到哪，再算关节怎么转”。

### 面试回答简版模板
`FK是从关节角推末端位姿，IK是从末端目标反解关节。实际项目一般FK驱动主动画，IK用于落地约束和交互修正。`

### 难点深挖
```mermaid
flowchart TD
  A[基础动作(FK)] --> B[检测地形/目标约束]
  B --> C[IK 求解修正关节]
  C --> D[混合输出最终骨骼姿态]
```
- 高频追问：IK 震荡怎么处理？
- 可通过阻尼、迭代次数限制、约束平滑和前后帧插值稳定。

---

## 题目：骨骼动画的了解？

### 标准准确的说法
- 骨骼动画系统通常包含：
- Skeleton（层级骨骼结构）。
- Animation Clip（按时间存关键帧：T/R/S）。
- 采样与插值（位置线性、旋转四元数 slerp）。
- 动画状态机/混合树（走、跑、跳、攻击切换）。
- 运行时流程：
- 更新状态机 -> 采样/混合骨骼姿态 -> 层级求全局矩阵 -> 蒙皮输出网格。
- 扩展能力：动画重定向、Root Motion、Additive 动画层。

### 通俗易懂的理解
- 骨骼动画不直接存每帧网格，而是存骨骼动作，再实时驱动网格，省内存也更灵活。

### 面试回答简版模板
`骨骼动画由骨骼层级、关键帧采样和状态机驱动组成。运行时先得到骨骼姿态，再通过蒙皮生成最终网格，支持混合与重定向。`

### 难点深挖
- 追问建议：描述一个完整运行链路（状态机 -> 采样 -> 混合 -> 蒙皮）比只说概念更有说服力。
